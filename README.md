### Installation
1. Download "sleep_scoring_app_vx" (the suffix "vx" denotes the current version) and unzip it as needed. Note if you unzip it to the same location where the zip file is, you may end up with a layered folder, ie., a "sleep_scoring_app_vx" inside a "sleep_scoring_app_vx". If this is the case , you need to peel it and move the inner "sleep_scoring_app_vx" somewhere else and delete the outer "sleep_scoring_app_vx". Please make sure you check this.  
2. Examine the content of the unzipped "sleep_scoring_app_vx". If it doesn't contain a folder called "model_save_states", download "model_save_states" and unzip it as needed, to "sleep_scoring_app_vx", where you see "run_app.exe".

### Usage 
1. Double click "run_app.exe" to open the app, which will open a page in your web browser.
2. After the app opens, click "Generate prediction" if you want to generate sleep score predictions on an unscored file or choose "Visualize existing prediction" if you want to visualize the prediction.
3. Click Select Files. If you chose "Generate prediction", then use the file finder that should pop up now to select the data (the .mat file generated by preprocess_sleep_data.m), the output is a .mat file that has the default name of the name of the data file plus a "_prediction" and model name and number of class added. If you chose "Visualize existing prediction", then select the prediction .mat file.
4. You can add your annotations by selecting the Box Select tool. Once selected an area, you can update the sleep scores by pressing 1, 2, or 3 on the keyboard. After you are done annotating the sleep scores, click the "Save Annotations" button located on the bottom left. Your annotations will be saved in the same prediction file.

#### Notes:
1. Please do not move the files or the folders around in the "sleep_scoring_app_vx" folder, it may break the app.
2. If you don't have a preprocessed sleep data file yet and you want to test run the app, you can use a sample preprocessed file from the "data_preprocessed" folder for a demo. Look for it in the same Onedrive folder where you download the app.

#### Demo
https://github.com/yzhaoinuw/sleep_scoring/assets/22312388/1f83cd67-6952-47d0-9c42-34487f3bb047

#### FAQ
v0.6.0 (added 11/28/2023)
1. **Why do the EEG, EMG, and NE signals not recover after I click *Reset*?**
A: When clicking Reset Axes after a very close up zoom-in, you may see that the signals don't recover or take a long time to recover. When this happens, simply slightly adjust the zoom level by scrolling on your mouse, after a split second, the signals should recover.

2. **Why does the sdreamer model seem to leave the last couple of seconds of my data unscored?**
A: When using the sdreamer model, you may notice that the last couple of seconds of signals unscored. But it should be no more than 64 seconds (if it is, please report to us). This is because the sdreamer model processes the signals based on 64-second sections. If the total duration of the signals cannot divide 64 evenly, there will be a leftover that's unscored. We plan to fix this issue in the next model.

3. **When zooming in or out, the upsampling of the signals is very slow to catch up.**
A: if you find the upsampling of the signals slow to catch up as you zoom in or out, try to slow down your zooming and see if that helps.

4. **Why does my annotation not work?**
A: First, check that you have selected **Box Select** above the graph on the right. Sometimes it maybe hidden. But as soon as you hover your cursor over there, it will appear. Second, make sure that the key you pressed is among the accepted keys. For example, if you are visualizing 3-class prediction results, then only **1**, **2**, and **3** are available for annotation. If it's a 4-class prediction result, then you would have the additioinal key, **4**, available. Any other keypress is ignored. 


#### Build from Source (Run using Anaconda)
There are three preparation processes that you need to do beforing using the app with Anaconda.

1. Install Miniconda, a minimal install of Anaconda. Follow the instrcutions here: https://docs.conda.io/projects/miniconda/en/latest/miniconda-install.html

2. Sign up for a GitHub account if you haven't. This is needed because, our sleep scoring app repository hosted on GitHub is a private repo because a model the app uses is not yet published. And as a private repo, you must have a GitHub account that you can share with me. Once I add you as a collaborator, you can download it and get updates from it. Follow the instructions here to sign up: https://docs.github.com/en/get-started/signing-up-for-github/signing-up-for-a-new-github-account. After you sign up, please send me your GitHub account name and I will add you to our private repo.

3. Get Git if you haven't. You need it to download the repo and getting updates. Follow the instructions here: https://git-scm.com/book/en/v2/Getting-Started-Installing-Git

#### Set up the environment
After you have done the prep work above, open you anaconda terminal or anaconda power shell prompt, and then replicate the conda environment we use to develop the app by typing
```bash
conda env create -f environment.yml
```
You only need to do this **once**, but it is important that you do this step successfully to ensure a smooth run of the app.

#### Activate  the environment
Next, activate the enviroment called sleep_scoring_dist, by typing
```bash
conda activate sleep_scoring_dist
```
In the future before you run the app, you need to activate this environment.

#### download the source code for the app
```bash
git clone https://github.com/yzhaoinuw/sleep_scoring.git
```
At whatever directory you run this command will download the source code there. Of course, you can place the source code folder anywhere you like afterwards. Then, use the command *cd*, which stands for change directory, in your command line to change to where you place the sleep_scoring folder. 

#### Run the app
Last step, type
```bash
python app.py
```
to run the app.

#### Update the app
When there's an update announced, it's starightforward to get the update from source. Have the environment activated, cd to the source code folder, then type
```bash
git pull origin dev
```

